# buffer和cache

指free命令中显示的buffer/cache。

## buffer

通常理解为向磁盘**写**数据的缓存，实际上更准确的定义应该是：

> 作为**buffer cache**的内存，是**磁盘块（即扇区）**的**读写**缓冲区。

- 对原始磁盘块的临时存储，也就是用来缓存磁盘的数据，通常不会特别大（20MB左右）。
- 内核可以把分散的写集中起来，统一优化磁盘的写入，比如可以把多次小的写合并成单次大的写。
- 既可以用作“将要写入磁盘数据的缓存”，也可以用作“从磁盘读取数据的缓存”。
- 数据可以是来自一个磁盘上任意一个扇区的数据。

## cache

通常理解为文件的**读**缓存，实际上更准确的定义应该是：

> 作为**page cache**的内存，是**文件系统**的**读写**缓冲区。

- 从磁盘读取文件的页缓存，也就是用来缓存从文件读取的数据。
- 既可以用作“从文件读取数据的页缓存”，也可以用作“写文件的页缓存”。
- 数据肯定是文件系统下的文件的data数据所存放的那些扇区。

## 区分磁盘和文件

这里说的“磁盘”对应操作对象是**块设备**文件，“文件”的操作对象则是**普通**文件。

```
// ls -l 查看文件类型，文件权限前的字符表示文件类型：
-: 普通文件
d: 目录
c: 字符设备
b: 块设备
s: socket
l: 软链接(硬链接是普通文件)
```

- 读写普通文件时，I/O 请求会经过文件系统，由文件系统负责，来与磁盘进行交互；
- 读写块设备文件时，会跳过文件系统，直接与磁盘交互，也就是所谓的“裸I/O”；
- 文件系统管理的缓存，是 Cache 的一部分；
- 磁盘的缓存，用的是Buffer。
# 组个宿舍局域网

## 物理层

解决物理连通性。

### 两台电脑

#### “p2p网线”

一头插在一台电脑的网卡上，另一头插在另一台电脑的网卡上。但是水晶头要做交叉线，用的就是所谓的**1－3、2－6交叉接法**。

> 水晶头的第1、2和第3、6脚，它们分别起着收、发信号的作用。将一端的1号和3号线、2号和6号线互换一下位置，就能够在物理层实现一端发送的信号，另一端能收到。

### 更多电脑

#### 集线器hub

有多个口，可以将宿舍里的多台电脑连接起来。但是，和交换机不同，集线器没有大脑，它完全在物理层工作。它会**将自己收到的每一个字节，都复制到其他端口上去**。

## 数据链路(MAC)层

解决问题：发给谁，谁接收？

### 目标的MAC地址和源的MAC地址

有了目标MAC地址，数据包在链路上广播，MAC的网卡才能发现，这个包是给它的。

#### 如何知道对方的MAC地址

ARP:已知IP地址，求MAC地址的协议。

通过广播ARP请求来获取MAC地址，并做缓存，缓存会过期。

![image](https://raw.githubusercontent.com/ingangi/blog/master/img/arp_flow.jpg)

### 交换机

Hub不管三七二十一都转发的做法效率低下，不够智能。

交换机能把MAC头拿下来，检查一下目标MAC地址（所以它是二层设备），然后根据策略转发的设备。

#### 转发表学习

一台MAC1电脑将一个包发送给另一台MAC2电脑，当这个包到达交换机的时候，一开始交换机也不知道MAC2的电脑在哪个口，所以没办法，它只能将包转发给除了来的那个口之外的其他所有的口。但是，这个时候，交换机会干一件非常聪明的事情，就是交换机会记住，MAC1是来自一个明确的口。以后有包的目的地址是MAC1的，直接发送到这个口就可以了。

## 网络层配置IP

宿舍电脑要配在同一个网段，否则不通，因为Linux首先会判断，要去的这个地址和我是一个网段的吗，或者和我的一个网卡是同一网段的吗？只有是一个网段的，它才会发送ARP请求，获取MAC地址。如果发现不是呢？

> Linux默认的逻辑是，如果这是一个跨网段的调用，它便不会直接将包发送到网络上，而是企图将包发送到网关。

```
# 使用net-tools：
$ sudo ifconfig eth1 10.0.0.1/24
$ sudo ifconfig eth1 up

# 使用iproute2：
$ sudo ip addr add 10.0.0.1/24 dev eth1
$ sudo ip link set up eth1
```